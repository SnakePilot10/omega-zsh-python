#!/bin/bash

# Hook de Omega-ZSH para evitar subir cÃ³digo roto
echo "ğŸš€ Validando cambios antes del push..."

# Navegar a la raÃ­z del proyecto
# (El hook se ejecuta desde la raÃ­z del repo)

# Activar el entorno virtual
if [ -d ".venv" ]; then
    source .venv/bin/activate
else
    echo "âŒ Error: No se encontrÃ³ el entorno virtual (.venv)"
    exit 1
fi

# Ejecutar los tests
echo "ğŸ§ª Ejecutando pytest..."
pytest -q
TEST_EXIT_CODE=$?

if [ $TEST_EXIT_CODE -ne 0 ]; then
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "âŒ ERROR: Los tests fallaron. El push ha sido cancelado."
    echo "ğŸ’¡ Revisa los errores arriba y arrÃ©glalos antes de subir."
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    exit 1
fi

echo "âœ… Todos los tests pasaron. Subiendo a GitHub..."
exit 0
